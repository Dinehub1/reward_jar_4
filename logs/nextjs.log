
> rewardjar_4.0@0.1.0 dev
> next dev

   â–² Next.js 15.3.5
   - Local:        http://localhost:3000
   - Network:      http://192.168.29.83:3000
   - Environments: .env.local

 âœ“ Starting...
 âœ“ Ready in 8.7s
 â—‹ Compiling /api/health ...
 âœ“ Compiled /api/health in 10.1s (361 modules)
 GET /api/health 200 in 11249ms
 â—‹ Compiling /api/health/env ...
 âœ“ Compiled /api/health/env in 5.1s (510 modules)
ğŸ” Starting environment validation...
âœ… Environment validation completed: 69% (9/13)
 GET /api/health/env 200 in 5674ms
 â—‹ Compiling /api/test/database-check ...
 âœ“ Compiled /api/test/database-check in 4.3s (621 modules)
ğŸ” Testing Supabase database connectivity...
âœ… Database query successful: []
 GET /api/test/database-check 200 in 5798ms
 â—‹ Compiling /api/auth/status ...
 âœ“ Compiled /api/auth/status in 1685ms (623 modules)
=== AUTH STATUS CHECK ===
Auth Status: No authenticated user
 GET /api/auth/status 200 in 2153ms
 â—‹ Compiling /api/health/wallet ...
 âœ“ Compiled /api/health/wallet in 2s (625 modules)
 GET /api/health/wallet 200 in 2409ms
 â—‹ Compiling /join/[cardId] ...
 âœ“ Compiled /join/[cardId] in 20.8s (1300 modules)
 âœ“ Compiled in 5.4s (450 modules)
 GET /join/faccf70b-eb79-45c7-ba0e-fcf9fe4a8498?guest=true 200 in 30029ms
 â—‹ Compiling /api/business/dashboard ...
 âœ“ Compiled /api/business/dashboard in 2.8s (1286 modules)
=== BUSINESS DASHBOARD API START ===
Dashboard API: Authentication failed: Auth session missing!
 GET /api/business/dashboard 401 in 3595ms
 â—‹ Compiling /api/dev-seed ...
 âœ“ Compiled /api/dev-seed in 1513ms (1288 modules)
 GET /api/dev-seed 200 in 2897ms
 POST /api/test/database-check 405 in 120ms
 POST /api/test/database-check 405 in 43ms
ğŸ” Testing Supabase database connectivity...
âœ… Database query successful: []
 GET /api/test/database-check 200 in 319ms
 GET /join/faccf70b-eb79-45c7-ba0e-fcf9fe4a8498?guest=true 200 in 1610ms
 â—‹ Compiling /api/wallet/apple/[customerCardId] ...
 âœ“ Compiled /api/wallet/apple/[customerCardId] in 9.2s (1409 modules)
ğŸ Generating Apple Wallet for card ID: faccf70b-eb79-45c7-ba0e-fcf9fe4a8498
âŒ Customer card not found: {
  code: 'PGRST116',
  details: 'The result contains 0 rows',
  hint: null,
  message: 'JSON object requested, multiple (or no) rows returned'
}
 HEAD /api/wallet/apple/faccf70b-eb79-45c7-ba0e-fcf9fe4a8498 404 in 14743ms
 â—‹ Compiling /api/health/env ...
 âœ“ Compiled /api/health/env in 971ms (1105 modules)
ğŸ” Starting environment validation...
âœ… Environment validation completed: 69% (9/13)
 GET /api/health/env 200 in 1209ms
 GET /api/dev-seed 200 in 403ms
 âœ“ Compiled in 1790ms (450 modules)
 â—‹ Compiling /api/test/database-check ...
 âœ“ Compiled /api/test/database-check in 1324ms (199 modules)
ğŸ” Testing Supabase database connectivity...
âœ… Database queries successful
 GET /api/test/database-check 200 in 2316ms
 â—‹ Compiling /join/[cardId] ...
 âœ“ Compiled /join/[cardId] in 865ms (702 modules)
 GET /join/faccf70b-eb79-45c7-ba0e-fcf9fe4a8498 200 in 3153ms
 â—‹ Compiling /api/dev-seed ...
 âœ“ Compiled /api/dev-seed in 898ms (704 modules)
Error generating demo cards: SyntaxError: Unexpected end of JSON input
    at JSON.parse (<anonymous>)
    at async POST (src/app/api/dev-seed/route.ts:140:17)
  138 |     lastGenerationTime = now
  139 |
> 140 |     const body = await request.json()
      |                 ^
  141 |     const { createAll = false, scenario, count = 1 } = body
  142 |
  143 |     // Check for existing cards to prevent duplicates
 POST /api/dev-seed 500 in 2625ms
 â—‹ Compiling /api/wallet/apple/[customerCardId] ...
 âœ“ Compiled /api/wallet/apple/[customerCardId] in 4.9s (971 modules)
ğŸ Generating Apple Wallet for card ID: 8e78f3d8-ed50-4a2a-b4e6-91e30d158e95
âŒ Customer card not found: {
  code: 'PGRST116',
  details: 'The result contains 0 rows',
  hint: null,
  message: 'JSON object requested, multiple (or no) rows returned'
}
 HEAD /api/wallet/apple/8e78f3d8-ed50-4a2a-b4e6-91e30d158e95 404 in 6889ms
ğŸ Generating Apple Wallet for card ID: 8e78f3d8-ed50-4a2a-b4e6-91e30d158e95
âŒ Customer card not found: {
  code: 'PGRST116',
  details: 'The result contains 0 rows',
  hint: null,
  message: 'JSON object requested, multiple (or no) rows returned'
}
 GET /api/wallet/apple/8e78f3d8-ed50-4a2a-b4e6-91e30d158e95 404 in 209ms
 â—‹ Compiling /auth/login ...
 âœ“ Compiled /auth/login in 11.5s (1147 modules)
 âœ“ Compiled in 3.1s (529 modules)
 âœ“ Compiled in 779ms (529 modules)
 â—‹ Compiling /api/wallet/apple/[customerCardId] ...
 âœ“ Compiled /api/wallet/apple/[customerCardId] in 1214ms (466 modules)
ğŸ Generating Apple Wallet for card ID: 8e78f3d8-ed50-4a2a-b4e6-91e30d158e95
âœ… Fetched customer card: {
  id: '8e78f3d8-ed50-4a2a-b4e6-91e30d158e95',
  current_stamps: 1,
  membership_type: 'loyalty',
  sessions_used: 0,
  total_sessions: null,
  cost: null,
  expiry_date: null,
  created_at: '2025-07-15T19:05:02.494916+00:00',
  updated_at: '2025-07-16T19:22:28.510015+00:00',
  stamp_cards: {
    id: '6b79ddcb-79fa-4b03-837e-b8ac7bedb335',
    name: 'Pizza Club',
    businesses: { name: 'Pizza Palace', description: 'Authentic Italian pizza' },
    total_stamps: 5,
    reward_description: 'Free pizza after 5 purchases'
  }
}
Starting PKPass generation...
Generated 6 icon files
Generated pass.json: 2786 bytes
Generated manifest.json with 7 files
Certificate validation passed: {
  passExpires: '2026-08-15T13:42:37.000Z',
  wwdrExpires: '2030-12-10T00:00:00.000Z'
}
Running OpenSSL command for PKCS#7 signature...
Created PKCS#7 signature using OpenSSL: 3191 bytes
Generated signature: 3191 bytes
Finalizing PKPass archive...
PKPass archive created successfully
âœ… PKPass generated successfully: { size: 5486, sizeKB: '5.4' }
 HEAD /api/wallet/apple/8e78f3d8-ed50-4a2a-b4e6-91e30d158e95 200 in 4111ms
 â—‹ Compiling /api/wallet/google/[customerCardId] ...
 âœ“ Compiled /api/wallet/google/[customerCardId] in 5s (1129 modules)
ğŸ« Generating Google Wallet pass for card: 8e78f3d8-ed50-4a2a-b4e6-91e30d158e95
ğŸ“‹ Card type detected: Stamp Cards
ğŸ·ï¸ Setting Google Wallet title to: "Stamp Cards"
ğŸ” Signing JWT with RS256 algorithm for Google Wallet
ğŸ” Processing private key format...
âœ… Private key validated successfully
ğŸ” Signing JWT with RS256...
âœ… JWT signed successfully
 HEAD /api/wallet/google/8e78f3d8-ed50-4a2a-b4e6-91e30d158e95 200 in 7147ms
 â—‹ Compiling /api/wallet/pwa/[customerCardId] ...
 âœ“ Compiled /api/wallet/pwa/[customerCardId] in 1699ms (1117 modules)
Generating PWA Wallet for card ID: 8e78f3d8-ed50-4a2a-b4e6-91e30d158e95
Fetched customer card: {
  id: '8e78f3d8-ed50-4a2a-b4e6-91e30d158e95',
  current_stamps: 1,
  membership_type: 'loyalty',
  sessions_used: 0,
  total_sessions: null,
  cost: null,
  expiry_date: null,
  created_at: '2025-07-15T19:05:02.494916+00:00',
  stamp_cards: {
    id: '6b79ddcb-79fa-4b03-837e-b8ac7bedb335',
    name: 'Pizza Club',
    businesses: { name: 'Pizza Palace', description: 'Authentic Italian pizza' },
    total_stamps: 5,
    reward_description: 'Free pizza after 5 purchases'
  }
}
Card Type: Loyalty
Stamp Card: {
  id: '6b79ddcb-79fa-4b03-837e-b8ac7bedb335',
  name: 'Pizza Club',
  total_stamps: 5,
  reward_description: 'Free pizza after 5 purchases'
}
Business: { name: 'Pizza Palace', description: 'Authentic Italian pizza' }
 HEAD /api/wallet/pwa/8e78f3d8-ed50-4a2a-b4e6-91e30d158e95 200 in 4408ms
 â—‹ Compiling /join/[cardId] ...
 âœ“ Compiled /join/[cardId] in 3.6s (1103 modules)
 GET /join/8e78f3d8-ed50-4a2a-b4e6-91e30d158e95?guest=true 200 in 5071ms
 GET /join/8e78f3d8-ed50-4a2a-b4e6-91e30d158e95 200 in 214ms
ğŸ Generating Apple Wallet for card ID: 8e78f3d8-ed50-4a2a-b4e6-91e30d158e95
âŒ Customer card not found: {
  message: 'TypeError: fetch failed',
  details: 'TypeError: fetch failed\n' +
    '    at node:internal/deps/undici/undici:13502:13\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async GET (webpack-internal:///(rsc)/./src/app/api/wallet/apple/[customerCardId]/route.ts:49:47)\n' +
    '    at async AppRouteRouteModule.do (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:34112)\n' +
    '    at async AppRouteRouteModule.handle (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:41338)\n' +
    '    at async doRender (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/server/base-server.js:1518:42)\n' +
    '    at async DevServer.renderToResponseWithComponentsImpl (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/server/base-server.js:1920:28)\n' +
    '    at async DevServer.renderPageComponent (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/server/base-server.js:2408:24)\n' +
    '    at async DevServer.renderToResponseImpl (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/server/base-server.js:2445:32)\n' +
    '    at async DevServer.pipeImpl (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/server/base-server.js:1008:25)\n' +
    '    at async NextNodeServer.handleCatchallRenderRequest (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/server/next-server.js:305:17)\n' +
    '    at async DevServer.handleRequestImpl (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/server/base-server.js:900:17)\n' +
    '    at async /Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/server/dev/next-dev-server.js:371:20\n' +
    '    at async Span.traceAsyncFn (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/trace/trace.js:157:20)\n' +
    '    at async DevServer.handleRequest (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/server/dev/next-dev-server.js:368:24)\n' +
    '    at async invokeRender (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/server/lib/router-server.js:237:21)\n' +
    '    at async handleRequest (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/server/lib/router-server.js:428:24)\n' +
    '    at async requestHandlerImpl (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/server/lib/router-server.js:452:13)\n' +
    '    at async Server.requestListener (/Users/dev/Documents/Reward jar 4.0/rewardjar_4.0/node_modules/next/dist/server/lib/start-server.js:158:13)',
  hint: '',
  code: ''
}
 GET /api/wallet/apple/8e78f3d8-ed50-4a2a-b4e6-91e30d158e95 404 in 1377ms
ğŸ« Generating Google Wallet pass for card: 8e78f3d8-ed50-4a2a-b4e6-91e30d158e95
ğŸ“‹ Card type detected: Stamp Cards
ğŸ·ï¸ Setting Google Wallet title to: "Stamp Cards"
ğŸ” Signing JWT with RS256 algorithm for Google Wallet
ğŸ” Processing private key format...
âœ… Private key validated successfully
ğŸ” Signing JWT with RS256...
âœ… JWT signed successfully
 GET /api/wallet/google/8e78f3d8-ed50-4a2a-b4e6-91e30d158e95 200 in 1154ms
Generating PWA Wallet for card ID: 8e78f3d8-ed50-4a2a-b4e6-91e30d158e95
Fetched customer card: {
  id: '8e78f3d8-ed50-4a2a-b4e6-91e30d158e95',
  current_stamps: 1,
  membership_type: 'loyalty',
  sessions_used: 0,
  total_sessions: null,
  cost: null,
  expiry_date: null,
  created_at: '2025-07-15T19:05:02.494916+00:00',
  stamp_cards: {
    id: '6b79ddcb-79fa-4b03-837e-b8ac7bedb335',
    name: 'Pizza Club',
    businesses: { name: 'Pizza Palace', description: 'Authentic Italian pizza' },
    total_stamps: 5,
    reward_description: 'Free pizza after 5 purchases'
  }
}
Card Type: Loyalty
Stamp Card: {
  id: '6b79ddcb-79fa-4b03-837e-b8ac7bedb335',
  name: 'Pizza Club',
  total_stamps: 5,
  reward_description: 'Free pizza after 5 purchases'
}
Business: { name: 'Pizza Palace', description: 'Authentic Italian pizza' }
 GET /api/wallet/pwa/8e78f3d8-ed50-4a2a-b4e6-91e30d158e95 200 in 585ms
 â—‹ Compiling /api/test/database-check ...
 âœ“ Compiled /api/test/database-check in 5.7s (604 modules)
ğŸ” Testing Supabase database connectivity...
âœ… Database queries successful
 GET /api/test/database-check 200 in 7006ms
 â—‹ Compiling /api/health/env ...
 âœ“ Compiled /api/health/env in 3.8s (737 modules)
ğŸ” Starting environment validation...
âœ… Environment validation completed: 69% (9/13)
 GET /api/health/env 200 in 4086ms
ğŸ Generating Apple Wallet for card ID: 8e78f3d8-ed50-4a2a-b4e6-91e30d158e95
âœ… Fetched customer card: {
  id: '8e78f3d8-ed50-4a2a-b4e6-91e30d158e95',
  current_stamps: 1,
  membership_type: 'loyalty',
  sessions_used: 0,
  total_sessions: null,
  cost: null,
  expiry_date: null,
  created_at: '2025-07-15T19:05:02.494916+00:00',
  updated_at: '2025-07-16T19:22:28.510015+00:00',
  stamp_cards: {
    id: '6b79ddcb-79fa-4b03-837e-b8ac7bedb335',
    name: 'Pizza Club',
    businesses: { name: 'Pizza Palace', description: 'Authentic Italian pizza' },
    total_stamps: 5,
    reward_description: 'Free pizza after 5 purchases'
  }
}
Starting PKPass generation...
Generated 6 icon files
Generated pass.json: 2786 bytes
Generated manifest.json with 7 files
Certificate validation passed: {
  passExpires: '2026-08-15T13:42:37.000Z',
  wwdrExpires: '2030-12-10T00:00:00.000Z'
}
Running OpenSSL command for PKCS#7 signature...
Created PKCS#7 signature using OpenSSL: 3191 bytes
Generated signature: 3191 bytes
Finalizing PKPass archive...
PKPass archive created successfully
âœ… PKPass generated successfully: { size: 5486, sizeKB: '5.4' }
 GET /api/wallet/apple/8e78f3d8-ed50-4a2a-b4e6-91e30d158e95 200 in 1105ms
ğŸ Generating Apple Wallet for card ID: 8e78f3d8-ed50-4a2a-b4e6-91e30d158e95
âœ… Fetched customer card: {
  id: '8e78f3d8-ed50-4a2a-b4e6-91e30d158e95',
  current_stamps: 1,
  membership_type: 'loyalty',
  sessions_used: 0,
  total_sessions: null,
  cost: null,
  expiry_date: null,
  created_at: '2025-07-15T19:05:02.494916+00:00',
  updated_at: '2025-07-16T19:22:28.510015+00:00',
  stamp_cards: {
    id: '6b79ddcb-79fa-4b03-837e-b8ac7bedb335',
    name: 'Pizza Club',
    businesses: { name: 'Pizza Palace', description: 'Authentic Italian pizza' },
    total_stamps: 5,
    reward_description: 'Free pizza after 5 purchases'
  }
}
Starting PKPass generation...
Generated 6 icon files
Generated pass.json: 2786 bytes
Generated manifest.json with 7 files
Certificate validation passed: {
  passExpires: '2026-08-15T13:42:37.000Z',
  wwdrExpires: '2030-12-10T00:00:00.000Z'
}
Running OpenSSL command for PKCS#7 signature...
Created PKCS#7 signature using OpenSSL: 3191 bytes
Generated signature: 3191 bytes
Finalizing PKPass archive...
PKPass archive created successfully
âœ… PKPass generated successfully: { size: 5484, sizeKB: '5.4' }
 GET /api/wallet/apple/8e78f3d8-ed50-4a2a-b4e6-91e30d158e95 200 in 530ms
ğŸ Generating Apple Wallet for card ID: 8e78f3d8-ed50-4a2a-b4e6-91e30d158e95
âœ… Fetched customer card: {
  id: '8e78f3d8-ed50-4a2a-b4e6-91e30d158e95',
  current_stamps: 1,
  membership_type: 'loyalty',
  sessions_used: 0,
  total_sessions: null,
  cost: null,
  expiry_date: null,
  created_at: '2025-07-15T19:05:02.494916+00:00',
  updated_at: '2025-07-16T19:22:28.510015+00:00',
  stamp_cards: {
    id: '6b79ddcb-79fa-4b03-837e-b8ac7bedb335',
    name: 'Pizza Club',
    businesses: { name: 'Pizza Palace', description: 'Authentic Italian pizza' },
    total_stamps: 5,
    reward_description: 'Free pizza after 5 purchases'
  }
}
Starting PKPass generation...
Generated 6 icon files
Generated pass.json: 2786 bytes
Generated manifest.json with 7 files
Certificate validation passed: {
  passExpires: '2026-08-15T13:42:37.000Z',
  wwdrExpires: '2030-12-10T00:00:00.000Z'
}
Running OpenSSL command for PKCS#7 signature...
Created PKCS#7 signature using OpenSSL: 3191 bytes
Generated signature: 3191 bytes
Finalizing PKPass archive...
PKPass archive created successfully
âœ… PKPass generated successfully: { size: 5487, sizeKB: '5.4' }
 GET /api/wallet/apple/8e78f3d8-ed50-4a2a-b4e6-91e30d158e95 200 in 736ms
 â—‹ Compiling /auth/login ...
 âœ“ Compiled /auth/login in 3.9s (632 modules)
 â¨¯ [TypeError: Cannot read properties of undefined (reading 'clientModules')] {
  page: '/auth/login'
}
 â—‹ Compiling /_error ...
 âœ“ Compiled /_error in 5.2s (1480 modules)
 â—‹ Compiling / ...
 âœ“ Compiled / in 1653ms (1505 modules)
 GET / 200 in 2741ms
 GET /auth/login 200 in 100ms
 â—‹ Compiling /_not-found ...
 âœ“ Compiled /_not-found in 1985ms (1508 modules)
 GET /_next/static/chunks/app/auth/login/page.js 404 in 2753ms
